# 状态码

## 概述

融云 IM API 使用统一的错误码体系，用于标识不同的错误类型和处理结果。

## 成功状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |

## 通用错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 1002 | AppKey不存在 | 检查 AppKey 是否正确 |
| 1003 | 参数错误 | 检查请求参数格式和必填项 |
| 1004 | 用户不存在 | 确认用户已注册 |
| 1005 | 群组不存在 | 确认群组已创建 |
| 1006 | 用户已在群组中 | 用户已经是群组成员 |
| 1007 | 群组成员数量超限 | 群组成员已达到上限 |
| 1008 | 时间格式错误 | 检查时间格式是否正确 |
| 1009 | 用户未被注销 | 用户状态正常，无需重新激活 |
| 1010 | 用户不是群主 | 只有群主才能执行此操作 |

## 消息相关错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 2001 | 消息内容格式错误 | 检查消息内容格式 |
| 2002 | 消息类型不支持 | 使用支持的消息类型 |
| 2003 | 消息长度超限 | 缩短消息内容 |
| 2004 | 用户被加入黑名单 | 检查黑名单设置 |
| 2005 | 消息发送频率限制 | 降低发送频率 |

## 群组相关错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 3001 | 群组ID已存在 | 使用不同的群组ID |
| 3002 | 群组名称格式错误 | 检查群组名称格式 |
| 3003 | 群组创建失败 | 检查群组创建参数 |
| 3004 | 群组解散失败 | 检查群组状态 |
| 3005 | 群组成员管理失败 | 检查成员操作权限 |

## 聊天室相关错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 4001 | 聊天室不存在 | 确认聊天室已创建 |
| 4002 | 聊天室创建失败 | 检查聊天室创建参数 |
| 4003 | 聊天室销毁失败 | 检查聊天室状态 |
| 4004 | 聊天室成员管理失败 | 检查成员操作权限 |

## 内容审核错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 5001 | 内容审核失败 | 检查内容是否符合规范 |
| 5002 | 审核服务不可用 | 稍后重试 |
| 5003 | 审核超时 | 检查网络连接 |

## 网络错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 6001 | 网络连接失败 | 检查网络连接 |
| 6002 | 请求超时 | 增加超时时间 |
| 6003 | 服务器内部错误 | 稍后重试 |
| 6004 | 服务不可用 | 检查服务状态 |

## 频率限制错误码

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 7001 | 请求频率超限 | 降低请求频率 |
| 7002 | 用户频率超限 | 控制用户操作频率 |
| 7003 | IP频率超限 | 检查IP限制 |

## 错误处理最佳实践

### 1. 错误分类处理
```javascript
function handleError(code) {
  switch (code) {
    case 200:
      return '操作成功';
    case 1002:
      return 'AppKey配置错误，请检查配置';
    case 1003:
      return '参数错误，请检查请求参数';
    case 1004:
      return '用户不存在，请先注册用户';
    case 2001:
      return '消息格式错误，请检查消息内容';
    case 7001:
      return '请求过于频繁，请稍后重试';
    default:
      return '未知错误，请稍后重试';
  }
}
```

### 2. 重试机制
```javascript
async function apiCallWithRetry(apiCall, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const result = await apiCall();
      if (result.code === 200) {
        return result;
      }
      
      // 对于某些错误码不进行重试
      if ([1002, 1003, 1004, 1005].includes(result.code)) {
        throw new Error(`API错误: ${result.code}`);
      }
      
      // 等待后重试
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    } catch (error) {
      if (i === maxRetries - 1) {
        throw error;
      }
    }
  }
}
```

### 3. 日志记录
```javascript
function logError(code, message, context) {
  console.error(`API错误 - 错误码: ${code}, 消息: ${message}`, {
    timestamp: new Date().toISOString(),
    context,
    errorCode: code
  });
}
```

## 监控建议

1. **错误率监控**：监控不同错误码的出现频率
2. **响应时间监控**：监控API响应时间
3. **成功率监控**：监控API调用成功率
4. **告警设置**：对关键错误设置告警机制 